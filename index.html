<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Digitação Microlins</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #4d50fd, #4f5ddd);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background-color: #f1f1f1;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background-color: #e9ecef;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 3px solid #4a6491;
            font-weight: bold;
        }
        
        .instructions {
            padding: 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .instructions h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background-color: #e9ecef;
            font-weight: bold;
            border-bottom: 1px solid #dee2e6;
            flex-wrap: wrap;
        }
        
        .stat-box {
            text-align: center;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            min-width: 120px;
            margin: 5px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .typing-area {
            padding: 25px;
        }
        
        .text-to-type {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 1.2rem;
            min-height: 150px;
            color: #495057;
            white-space: pre-wrap;
        }
        
        .input-area {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1.2rem;
            resize: none;
            transition: border-color 0.3s;
        }
        
        .input-area:focus {
            outline: none;
            border-color: #4a6491;
            box-shadow: 0 0 0 3px rgba(74, 100, 145, 0.25);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #start-btn {
            background-color: #28a745;
            color: white;
        }
        
        #start-btn:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        #reset-btn {
            background-color: #dc3545;
            color: white;
        }
        
        #reset-btn:hover {
            background-color: #c82333;
            transform: translateY(-2px);
        }
        
        #results-btn {
            background-color: #17a2b8;
            color: white;
        }
        
        #results-btn:hover {
            background-color: #138496;
            transform: translateY(-2px);
        }
        
        .results {
            display: none;
            padding: 25px;
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        
        .results h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .result-box {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .level-indicator {
            font-size: 1.3rem;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        .beginner {
            background-color: #ffcccc;
            color: #7189f7;
        }
        
        .basic {
            background-color: #ffebcc;
            color: #6e5efc65;
        }
        
        .intermediate {
            background-color: #ffffcc;
            color: #6077fa;
        }
        
        .advanced {
            background-color: #e6ffcc;
            color: #4d9900;
        }
        
        .expert {
            background-color: #ccffcc;
            color: #006600;
        }
        
        .evaluation-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .evaluation-table th, .evaluation-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        
        .evaluation-table th {
            background-color: #4a6491;
            color: white;
        }
        
        .evaluation-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .highlight {
            background-color: #fffacd !important;
            font-weight: bold;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #4a6491;
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            background-color: #2c3e50;
            color: white;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Teste de Digitação Microlins</h1>
            <p class="subtitle">Avalie suas habilidades no curso de digitação</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-lesson="1">Teste 1</div>
            <div class="tab" data-lesson="2">Teste 2</div>
            <div class="tab" data-lesson="3">Teste 3</div>
            <div class="tab" data-lesson="4">Teste 4</div>
            <div class="tab" data-lesson="5">Teste 5</div>
        </div>
        
        <section class="instructions">
            <h2>Instruções:</h2>
            <ul>
                <li>Selecione uma aula acima para praticar.</li>
                <li>Digite o texto abaixo exatamente como está apresentado.</li>
                <li><strong>Não acrescente acentos ou pontuação que não estejam no texto.</strong></li>
                <li>Clique em "Iniciar Teste" para começar. O cronômetro iniciará quando você começar a digitar.</li>
                <li>Concentre-se primeiro na precisão e depois na velocidade.</li>
            </ul>
        </section>
        
        <section class="stats">
            <div class="stat-box">
                <div class="stat-value" id="timer">05:00</div>
                <div class="stat-label">Tempo Restante</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="wpm">0</div>
                <div class="stat-label">Palavras por Minuto</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="accuracy">100%</div>
                <div class="stat-label">Precisão</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="consistency">100%</div>
                <div class="stat-label">Consistência</div>
            </div>
        </section>
        
        <section class="typing-area">
            <div class="text-to-type" id="text-to-type">
                SELECIONE O NÍVEL DO TESTE
            </div>
            
            <textarea class="input-area" id="typing-input" placeholder="Clique em 'Iniciar Teste' e comece a digitar aqui..." disabled></textarea>
            
            <div class="progress-container">
                <div>Progresso: <span id="progress-text">0%</span></div>
                <div class="progress-bar">
                    <div class="progress" id="progress-bar" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="controls">
                <button id="start-btn">Iniciar Teste</button>
                <button id="reset-btn" disabled>Reiniciar</button>
                <button id="results-btn" disabled>Ver Resultados</button>
            </div>
        </section>
        
        <section class="results" id="results">
            <h2>Seu Desempenho</h2>
            
            <div class="result-stats">
                <div class="result-box">
                    <div>Velocidade</div>
                    <div class="result-value" id="final-wpm">0 PPM</div>
                    <div>Palavras por Minuto</div>
                </div>
                <div class="result-box">
                    <div>Precisão</div>
                    <div class="result-value" id="final-accuracy">100%</div>
                    <div>Porcentagem de Acertos</div>
                </div>
                <div class="result-box">
                    <div>Consistência</div>
                    <div class="result-value" id="final-consistency">100%</div>
                    <div>Uniformidade da Digitação</div>
                </div>
                <div class="result-box">
                    <div>Tempo</div>
                    <div class="result-value" id="final-time">0s</div>
                    <div>Duração do Teste</div>
                </div>
            </div>
            
            <div class="level-indicator" id="level-indicator">
                <!-- O nível será inserido aqui via JavaScript -->
            </div>
            
            <table class="evaluation-table">
                <thead>
                    <tr>
                        <th>Nível</th>
                        <th>Velocidade (PPM)</th>
                        <th>Precisão</th>
                        <th>Consistência</th>
                        <th>Observações</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="beginner-row">
                        <td>Iniciante</td>
                        <td>0 - 20</td>
                        <td>&lt; 80%</td>
                        <td>&lt; 70%</td>
                        <td>Está familiarizando com a posição das teclas. Foca em olhar para o teclado.</td>
                    </tr>
                    <tr id="basic-row">
                        <td>Básico</td>
                        <td>21 - 35</td>
                        <td>80% - 89%</td>
                        <td>70% - 79%</td>
                        <td>Já tem alguma memória muscular. Comete alguns erros mas mostra progresso.</td>
                    </tr>
                    <tr id="intermediate-row">
                        <td>Intermediário</td>
                        <td>36 - 50</td>
                        <td>90% - 94%</td>
                        <td>80% - 89%</td>
                        <td>Consegue digitar trechos sem olhar constantemente para o teclado.</td>
                    </tr>
                    <tr id="advanced-row">
                        <td>Avançado</td>
                        <td>51 - 65</td>
                        <td>95% - 98%</td>
                        <td>90% - 95%</td>
                        <td>Domina as teclas das aulas. Digita com fluidez e poucos erros.</td>
                    </tr>
                    <tr id="expert-row">
                        <td>Expert</td>
                        <td>66+</td>
                        <td>99%+</td>
                        <td>96%+</td>
                        <td>Digitação rápida e precisa, com total domínio do conteúdo.</td>
                    </tr>
                </tbody>
            </table>
        </section>
        
        <footer>
            <p>Teste de Digitação - Baseado no conteúdo das Aulas 1 a 16</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos DOM
            const typingInput = document.getElementById('typing-input');
            const textToType = document.getElementById('text-to-type');
            const startBtn = document.getElementById('start-btn');
            const resetBtn = document.getElementById('reset-btn');
            const resultsBtn = document.getElementById('results-btn');
            const timerDisplay = document.getElementById('timer');
            const wpmDisplay = document.getElementById('wpm');
            const accuracyDisplay = document.getElementById('accuracy');
            const consistencyDisplay = document.getElementById('consistency');
            const resultsSection = document.getElementById('results');
            const finalWpm = document.getElementById('final-wpm');
            const finalAccuracy = document.getElementById('final-accuracy');
            const finalConsistency = document.getElementById('final-consistency');
            const finalTime = document.getElementById('final-time');
            const levelIndicator = document.getElementById('level-indicator');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const tabs = document.querySelectorAll('.tab');
            
            // Textos para cada aula
            const lessonTexts = {
                1: `o dia inicia com luz; o sol brilha nas nuvens; a casa tem uma porta; o gato dorme na cama; o carro desce a rua; o menino joga bola; a menina pula corda; o livro estava na mesa.  
o papel caiu no piso; o copo ficou cheio; a flor fica no vaso; o peixe nada no lago; o bolo ficou pronto; o suco esteve gelado; o cachorro corre no parque; o computador estava ligado.  
o mouse ficou ruim; o teclado quebrou; a tela mostra um jogo; o curso iniciou agora; vamos digitar com calma; o treino ajuda no foco; a pratica melhora tudo; o teste avalia ritmo.  
a tarefa foi simples; o aluno digita bem; a escola ensina com carinho; o tempo passa devagar; a janela ficou aberta; o vento entra devagar; o som estava baixo; o celular vibra o tempo todo.  
o amigo chega cedo; o grupo estuda junto; o texto tem frases curtas; o objetivo e aprender; a meta e melhorar; o resultado vem com treino.
`,

                2: `O mel é o único alimento que não estraga. Arqueólogos encontraram potes de mel com mais de 3.000 anos em pirâmides do Egito e ele ainda estava próprio para consumo.

Um único furacão pode liberar a energia equivalente a 10.000 bombas atômicas. A força da natureza é simplesmente colossal e incontrolável.

O coração da baleia-azul é tão grande que um ser humano poderia nadar em suas artérias. Este magnífico animal é o maior ser vivo do planeta.

Os números arábicos, que usamos no dia a dia (1, 2, 3...), não foram inventados pelos árabes. Eles foram criados na Índia e depois disseminados pelo mundo islâmico.

A torre Eiffel, em Paris, pode ser 15 centímetros mais alta durante o verão. O calor causa a expansão térmica do metal, tornando-a ligeiramente mais elevada.

O cérebro humano é mais ativo durante a noite, enquanto dormimos, do que durante o dia, quando estamos ocupados com nossas tarefas. Ele processa informações e consolida memórias.

Existem mais estrelas no universo do que grãos de areia em todas as praias do planeta Terra. A escala do cosmos é verdadeiramente inimaginável.

O ponto mais profundo dos oceanos, a Fossa das Marianas, tem cerca de 11.000 metros. Se colocássemos o Monte Everest lá, seu pico ainda estaria a mais de 2.000 metros da superfície.

A letra "j" é a única que não aparece na tabela periódica dos elementos. Uma curiosidade trivial, mas interessante para os amantes da língua e da ciência.

Os ursos-polares são praticamente invisíveis para as câmeras de calor. Sua pelagem espessa e sua camada de gordura isolam tão bem que seu corpo quase não emite calor.`,

                3: `Um Dia Comum na Cidade

O sol já ilumina as ruas; são 7h30 da manhã. As pessoas caminham rápido para seus trabalhos. Os carros passam, buzinas tocam, a cidade acorda.

João toma seu café: pão com manteiga e um suco de laranja. Ele pega suas chaves e seu telefone. Hoje é um dia importante na firma. Ele precisa terminar um relatório para as 15h.

Na rua, as crianças vão para a escola. Elas riem e correm. O ônibus para no ponto; muitas pessoas entram. João prefere ir a pé; é só 10 quarteirões.

O dia passa. O telefone toca; é Maria, sua irmã. Ela pergunta se ele vai ao jantar no domingo. "Claro que sim!", ele responde. Ele adora a comida de sua mãe.

Às 18h, João volta para casa. O céu está lindo, com nuvens cor-de-rosa. Ele compra pão fresquinho na padaria. Chegando em casa, liga o computador e ouve uma pouco de música.

À noite, ele fala com amigos pelo telefone. Eles planejam um passeio no sábado. João está feliz. Amanhã é sexta-feira! O final de semana está perto.

Fim de mais um dia comum, mas tranquilo. A vida é feita de pequenos momentos.`,

                4: `A Ciência do Café: Mais que uma Bebida

A história do café começou na Etiópia, no século IX. Diz a lenda que um pastor notou que suas cabras ficavam mais animadas após comer uns frutos vermelhos. Ele experimentou e sentiu uma nova energia.

O café, tal como o conhecemos, é o resultado de um processo complexo. Os grãos são, na verdade, sementes de uma fruta. Após a colheita, eles passam por secagem, torra e moagem. A torra é crucial; define o sabor: claro, médio ou escuro.

A bebida contém cafeína, um alcalóide que bloqueia a adenosina, um neurotransmissor que induz o sono. Por isso, ficamos mais alertas. Mas o efeito varia; algumas pessoas sentem nervosismo com apenas 50mg, outras precisam de 200mg.

Estudos recentes indicam que o consumo moderado (até 4 xícaras/dia) pode trazer benefícios. Está associado a um menor risco de diabetes tipo 2, doenças cardíacas e até Parkinson. Claro, sem exageros!

O Brasil é o maior produtor mundial há mais de 150 anos. Estados Unidos, Alemanha e Itália são os maiores consumidores. A próxima vez que você tomar um café, pense nessa jornada incrível.`,

                5: `Crônica de um Código: A Linguagem dos Sinais

A gênese de qualquer sistema complexo reside na sua lógica fundamental. O código-fonte, um conjunto de instruções precisas (e, por vezes, crípticas), dita o funcionamento de máquinas que regem nossa existência contemporânea.

Analisemos a frase: if (x > 10) { y = x * 2; } else { y = x + 5; }. Esta estrutura condicional simples, composta por símbolos específicos (,, ;, {}), exemplifica um fluxo de decisão. A máquina avalia a expressão e executa um caminho distinto.

Contudo, a verdadeira complexidade emerge na intersecção entre a sintaxe rígida e a semântica flexível. Um ponto-e-vírgula omitido (;) pode causar uma falha catastrófica. Paradoxalmente, a elegância de uma solução reside na sua simplicidade lógica, não na verbosidade.

Frequentemente, deparamo-nos com problemas NP-difíceis, para os quais não existem soluções triviais. A heurística torna-se nossa aliada, encontrando aproximações viáveis, ainda que não perfeitas. É a arte do "bom o suficiente".

O filosofo contemporâneo afirmou: "A tecnologia é o véu entre a percepção humana e a realidade algorítmica". Decifrar esses códigos, portanto, é mais que uma tarefa técnica; é uma busca por significado numa paisagem digital cada vez mais opaca. O desafio persiste.`,
            };
            
            // Variáveis do teste
            let timeLeft = 300; // 5 minutos em segundos
            let timerInterval;
            let testStarted = false;
            let startTime;
            let typedText = '';
            let originalText = textToType.textContent;
            let correctChars = 0;
            let totalChars = 0;
            let currentLesson = 1;
            let consistencyData = []; // Para calcular consistência
            
            // Event Listeners
            startBtn.addEventListener('click', startTest);
            resetBtn.addEventListener('click', resetTest);
            resultsBtn.addEventListener('click', showResults);
            typingInput.addEventListener('input', handleTyping);
            
            // Adicionar eventos para as abas
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remover a classe active de todas as abas
                    tabs.forEach(t => t.classList.remove('active'));
                    // Adicionar a classe active à aba clicada
                    this.classList.add('active');
                    // Alterar a lição atual
                    currentLesson = parseInt(this.getAttribute('data-lesson'));
                    // Carregar o texto da lição
                    loadLessonText(currentLesson);
                    // Reiniciar o teste se estiver em andamento
                    if (testStarted) {
                        resetTest();
                    }
                });
            });
            
            // Carregar texto da lição
            function loadLessonText(lesson) {
                originalText = lessonTexts[lesson];
                textToType.textContent = originalText;
                resetTest();
            }
            
            // Iniciar o teste
            function startTest() {
                testStarted = true;
                typingInput.disabled = false;
                typingInput.focus();
                startBtn.disabled = true;
                resetBtn.disabled = false;
                resultsBtn.disabled = true;
                
                // Iniciar o cronômetro
                startTime = new Date();
                timerInterval = setInterval(updateTimer, 1000);
                
                // Inicializar dados de consistência
                consistencyData = [];
            }
            
            // Atualizar o cronômetro
            function updateTimer() {
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endTest();
                    return;
                }
                
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Atualizar estatísticas em tempo real
                updateRealTimeStats();
            }
            
            // Atualizar estatísticas em tempo real
            function updateRealTimeStats() {
                if (!testStarted) return;
                
                const currentTime = new Date();
                const elapsedTime = (currentTime - startTime) / 1000 / 60; // em minutos
                
                // Calcular palavras por minuto
                const wordCount = countWords(typedText);
                const wpm = elapsedTime > 0 ? Math.round(wordCount / elapsedTime) : 0;
                wpmDisplay.textContent = wpm;
                
                // Calcular precisão
                const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
                accuracyDisplay.textContent = `${accuracy}%`;
                
                // Calcular e atualizar consistência
                updateConsistency(wpm, accuracy);
                
                // Atualizar barra de progresso
                updateProgress();
            }
            
            // Atualizar a consistência
            function updateConsistency(wpm, accuracy) {
                const currentTime = new Date();
                consistencyData.push({
                    time: currentTime,
                    wpm: wpm,
                    accuracy: accuracy
                });
                
                // Manter apenas os dados dos últimos 30 segundos para cálculo
                const thirtySecondsAgo = new Date(currentTime - 30000);
                consistencyData = consistencyData.filter(data => data.time > thirtySecondsAgo);
                
                if (consistencyData.length > 1) {
                    // Calcular variação de WPM
                    const wpmValues = consistencyData.map(data => data.wpm);
                    const wpmAvg = wpmValues.reduce((a, b) => a + b, 0) / wpmValues.length;
                    const wpmVariance = wpmValues.reduce((sum, value) => sum + Math.pow(value - wpmAvg, 2), 0) / wpmValues.length;
                    const wpmStdDev = Math.sqrt(wpmVariance);
                    
                    // Calcular variação de precisão
                    const accuracyValues = consistencyData.map(data => data.accuracy);
                    const accuracyAvg = accuracyValues.reduce((a, b) => a + b, 0) / accuracyValues.length;
                    const accuracyVariance = accuracyValues.reduce((sum, value) => sum + Math.pow(value - accuracyAvg, 2), 0) / accuracyValues.length;
                    const accuracyStdDev = Math.sqrt(accuracyVariance);
                    
                    // Calcular consistência geral (quanto menor o desvio padrão, maior a consistência)
                    const maxWpmStdDev = 10; // Valor máximo razoável para desvio padrão do WPM
                    const maxAccuracyStdDev = 5; // Valor máximo razoável para desvio padrão da precisão
                    
                    const wpmConsistency = Math.max(0, 100 - (wpmStdDev / maxWpmStdDev * 100));
                    const accuracyConsistency = Math.max(0, 100 - (accuracyStdDev / maxAccuracyStdDev * 100));
                    
                    const overallConsistency = Math.round((wpmConsistency + accuracyConsistency) / 2);
                    consistencyDisplay.textContent = `${overallConsistency}%`;
                } else {
                    consistencyDisplay.textContent = '100%';
                }
            }
            
            // Atualizar barra de progresso
            function updateProgress() {
                const progress = (typedText.length / originalText.length) * 100;
                const progressValue = Math.min(100, Math.round(progress));
                progressBar.style.width = `${progressValue}%`;
                progressText.textContent = `${progressValue}%`;
            }
            
            // Contar palavras em um texto
            function countWords(text) {
                return text.trim().split(/\s+/).length;
            }
            
            // Manipular a digitação
            function handleTyping() {
                if (!testStarted) return;
                
                typedText = typingInput.value;
                totalChars = typedText.length;
                
                // Calcular caracteres corretos
                correctChars = 0;
                for (let i = 0; i < Math.min(typedText.length, originalText.length); i++) {
                    if (typedText[i] === originalText[i]) {
                        correctChars++;
                    }
                }
                
                // Verificar se o texto foi completamente digitado
                if (typedText === originalText) {
                    endTest();
                }
                
                updateRealTimeStats();
            }
            
            // Finalizar o teste
            function endTest() {
                clearInterval(timerInterval);
                testStarted = false;
                typingInput.disabled = true;
                resultsBtn.disabled = false;
                
                // Calcular estatísticas finais
                const endTime = new Date();
                const elapsedTime = (endTime - startTime) / 1000; // em segundos
                const wordCount = countWords(typedText);
                const wpm = Math.round(wordCount / (elapsedTime / 60));
                const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
                
                // Calcular consistência final
                let finalConsistencyValue = 100;
                if (consistencyData.length > 1) {
                    const wpmValues = consistencyData.map(data => data.wpm);
                    const wpmAvg = wpmValues.reduce((a, b) => a + b, 0) / wpmValues.length;
                    const wpmVariance = wpmValues.reduce((sum, value) => sum + Math.pow(value - wpmAvg, 2), 0) / wpmValues.length;
                    const wpmStdDev = Math.sqrt(wpmVariance);
                    
                    const accuracyValues = consistencyData.map(data => data.accuracy);
                    const accuracyAvg = accuracyValues.reduce((a, b) => a + b, 0) / accuracyValues.length;
                    const accuracyVariance = accuracyValues.reduce((sum, value) => sum + Math.pow(value - accuracyAvg, 2), 0) / accuracyValues.length;
                    const accuracyStdDev = Math.sqrt(accuracyVariance);
                    
                    const maxWpmStdDev = 10;
                    const maxAccuracyStdDev = 5;
                    
                    const wpmConsistency = Math.max(0, 100 - (wpmStdDev / maxWpmStdDev * 100));
                    const accuracyConsistency = Math.max(0, 100 - (accuracyStdDev / maxAccuracyStdDev * 100));
                    
                    finalConsistencyValue = Math.round((wpmConsistency + accuracyConsistency) / 2);
                }
                
                // Exibir resultados
                finalWpm.textContent = `${wpm} PPM`;
                finalAccuracy.textContent = `${accuracy}%`;
                finalConsistency.textContent = `${finalConsistencyValue}%`;
                finalTime.textContent = `${Math.round(elapsedTime)}s`;
                
                // Determinar o nível
                determineLevel(wpm, accuracy, finalConsistencyValue);
            }
            
            // Determinar o nível com base na velocidade, precisão e consistência
            function determineLevel(wpm, accuracy, consistency) {
                // Remover destaque de todas as linhas
                document.querySelectorAll('.evaluation-table tr').forEach(row => {
                    row.classList.remove('highlight');
                });
                
                let level, levelClass, description;
                
                if (wpm <= 20 || accuracy < 80 || consistency < 70) {
                    level = "Iniciante";
                    levelClass = "beginner";
                    description = "Está familiarizando com a posição das teclas. Foca em olhar para o teclado.";
                    document.getElementById('beginner-row').classList.add('highlight');
                } else if (wpm <= 35 || accuracy < 90 || consistency < 80) {
                    level = "Básico";
                    levelClass = "basic";
                    description = "Já tem alguma memória muscular. Comete alguns erros mas mostra progresso.";
                    document.getElementById('basic-row').classList.add('highlight');
                } else if (wpm <= 50 || accuracy < 95 || consistency < 90) {
                    level = "Intermediário";
                    levelClass = "intermediate";
                    description = "Consegue digitar trechos sem olhar constantemente para o teclado.";
                    document.getElementById('intermediate-row').classList.add('highlight');
                } else if (wpm <= 65 || accuracy < 99 || consistency < 96) {
                    level = "Avançado";
                    levelClass = "advanced";
                    description = "Domina as teclas das aulas. Digita com fluidez e poucos erros.";
                    document.getElementById('advanced-row').classList.add('highlight');
                } else {
                    level = "Expert";
                    levelClass = "expert";
                    description = "Digitação rápida e precisa, com total domínio do conteúdo.";
                    document.getElementById('expert-row').classList.add('highlight');
                }
                
                levelIndicator.textContent = `Seu nível: ${level}`;
                levelIndicator.className = `level-indicator ${levelClass}`;
            }
            
            // Mostrar resultados
            function showResults() {
                resultsSection.style.display = 'block';
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Reiniciar o teste
            function resetTest() {
                clearInterval(timerInterval);
                testStarted = false;
                timeLeft = 300;
                timerDisplay.textContent = '05:00';
                wpmDisplay.textContent = '0';
                accuracyDisplay.textContent = '100%';
                consistencyDisplay.textContent = '100%';
                typingInput.value = '';
                typedText = '';
                totalChars = 0;
                correctChars = 0;
                typingInput.disabled = true;
                startBtn.disabled = false;
                resetBtn.disabled = true;
                resultsBtn.disabled = true;
                resultsSection.style.display = 'none';
                progressBar.style.width = '0%';
                progressText.textContent = '0%';
                
                // Remover destaque da tabela
                document.querySelectorAll('.evaluation-table tr').forEach(row => {
                    row.classList.remove('highlight');
                });
            }
        });
    </script>
</body>
</html>



